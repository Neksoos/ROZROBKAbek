# services/npc_quests.py
from __future__ import annotations

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Sequence, Tuple, Set, Any

# ‚õîÔ∏è –ñ–æ–¥–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –≤—ñ–¥ –ë–î/–±–æ—Ç–∞ ‚Äî —Ç—ñ–ª—å–∫–∏ –¥–∞–Ω—ñ –π —Ö–µ–ª–ø–µ—Ä–∏.
# –ü—ñ–¥ —Ü—ñ –∫–≤–µ—Å—Ç–∏ –≤–∂–µ —î 5 NPC —É services/npc_defs.py:
#  - berehynia_oksana, lirnyk_semen, nedochaklun_panas, nastia_salt_belly, yurko_rekrut


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# –ú–û–î–ï–õ–Ü –î–ê–ù–ò–•
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

@dataclass(frozen=True)
class ItemRef:
    """–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∑–∞ –Ω–∞–∑–≤–æ—é (name) —Ç–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é (qty)."""
    name: str
    qty: int = 1

    def to_dict(self) -> Dict[str, Any]:
        return {"name": self.name, "qty": int(self.qty)}


@dataclass(frozen=True)
class QuestReward:
    """
    –ù–∞–≥–æ—Ä–æ–¥–∞ –∑–∞ –∫–≤–µ—Å—Ç:
      - xp: –¥–æ—Å–≤—ñ–¥
      - chervontsi: —á–µ—Ä–≤–æ–Ω—Ü—ñ (–æ—Å–Ω–æ–≤–Ω–∞ –≤–∞–ª—é—Ç–∞)
      - items: –ø—Ä–µ–¥–º–µ—Ç–∏
    –ë—É–¥—å-—â–æ –∑ —Ü—å–æ–≥–æ –º–æ–∂–µ –±—É—Ç–∏ 0/–ø–æ—Ä–æ–∂–Ω—ñ–º.
    """
    xp: int = 0
    chervontsi: int = 0
    items: Tuple[ItemRef, ...] = ()

    def to_dict(self) -> Dict[str, Any]:
        return {
            "xp": int(self.xp),
            "chervontsi": int(self.chervontsi),
            "items": [i.to_dict() for i in self.items],
        }


@dataclass(frozen=True)
class QuestStage:
    """
    –ï—Ç–∞–ø –∫–≤–µ—Å—Ç—É. –¢—É—Ç —Ç—ñ–ª—å–∫–∏ –¥–∞–Ω—ñ.
    UI/—Ä–æ—É—Ç–µ—Ä–∏ –ø–æ–≤–∏–Ω–Ω—ñ:
      - –ø–æ–∫–∞–∑–∞—Ç–∏ text_lines;
      - –≤—ñ–¥—Ä–µ–Ω–¥–µ—Ä–∏—Ç–∏ choices (label -> next_stage_id);
      - —è–∫—â–æ stage –º–∞—î require_items ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏/—Å–ø–∏—Å–∞—Ç–∏;
      - —è–∫—â–æ stage –º–∞—î complete_reward ‚Äî –≤–∏–¥–∞—Ç–∏ –Ω–∞–≥–æ—Ä–æ–¥—É —ñ –∑–∞–≤–µ—Ä—à–∏—Ç–∏.
    """
    id: str
    text_lines: Tuple[str, ...]
    choices: Dict[str, str] = field(default_factory=dict)        # label -> next_stage_id
    require_items: Tuple[ItemRef, ...] = ()
    complete_reward: Optional[QuestReward] = None
    is_final: bool = False

    def to_dict(self) -> Dict[str, Any]:
        return {
            "id": self.id,
            "text_lines": list(self.text_lines),
            "choices": dict(self.choices),
            "require_items": [i.to_dict() for i in self.require_items],
            "complete_reward": self.complete_reward.to_dict() if self.complete_reward else None,
            "is_final": bool(self.is_final),
        }


@dataclass(frozen=True)
class QuestDef:
    """
    –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–≤–µ—Å—Ç—É.
    """
    npc_key: str
    quest_key: str
    title: str
    description: str
    stages: Dict[str, QuestStage]
    start_id: str
    once: bool = True
    level_req: int = 1

    def to_dict(self) -> Dict[str, Any]:
        return {
            "npc_key": self.npc_key,
            "quest_key": self.quest_key,
            "title": self.title,
            "description": self.description,
            "stages": {k: v.to_dict() for k, v in self.stages.items()},
            "start_id": self.start_id,
            "once": bool(self.once),
            "level_req": int(self.level_req),
        }


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# –õ–û–ö–ê–õ–¨–ù–ò–ô –ö–ê–¢–ê–õ–û–ì –ü–†–ï–î–ú–ï–¢–Ü–í –î–õ–Ø –ö–í–ï–°–¢–Ü–í
# type: "quest" / "consumable" / "trinket"
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

ITEM_CATALOG: Dict[str, Dict[str, str | int]] = {
    # –û–∫—Å–∞–Ω–∞ (–ü–æ–ª—Ç–∞–≤—â–∏–Ω–∞)
    "–í—ñ—Å–∫-–æ–±–µ—Ä—ñ–≥":         {"type": "quest", "desc": "–ß–∏—Å—Ç–∏–π –≤—ñ—Å–∫, –±–ª–∞–≥–∏–π –¥–æ —Å–≤—ñ—á–æ–∫."},
    "–°–≤—è—Ç–∞ —Å–≤—ñ—á–∫–∞ –û–∫—Å–∞–Ω–∏": {"type": "trinket", "desc": "–¢–µ–ø–ª–µ –ø–æ–ª—É–º‚Äô—è –¥–∞—î –≤—ñ–¥—á—É—Ç—Ç—è –∑–∞—Ö–∏—Å—Ç—É."},

    # –°–µ–º–µ–Ω (–ü–æ–¥—ñ–ª–ª—è)
    "–ö—ñ–≥—Ç—ñ —è—Ä—É–∂–Ω–æ–≥–æ –≤–æ–≤–∫—É–ª–∞–∫–∏": {"type": "quest", "desc": "–ì–æ—Å—Ç—Ä—ñ –π —Ç–µ–º–Ω—ñ –≤—ñ–¥ –¥–∞–≤–Ω—å–æ—ó —Å–∫–≤–µ—Ä–Ω–∏."},
    "–°—Ä—ñ–±–Ω–∏–π –º–µ–¥—è–∫ –°–µ–º–µ–Ω–∞":     {"type": "trinket", "desc": "–î–∑–≤–µ–Ω–∏—Ç—å, –º–æ–≤ —Å—Ç—Ä—É–Ω–∞. –ù–∞ —â–∞—Å—Ç—è."},

    # –ü–∞–Ω–∞—Å (–ü–æ–ª—ñ—Å—Å—è)
    "–†—è—Å–∫–∞ –±–æ–ª–æ—Ç—è–Ω–∞":       {"type": "quest", "desc": "–ó–µ–ª–µ–Ω—å —ñ–∑ —Ç–∏—Ö–∏—Ö –ø–ª–µ—Å."},
    "–ú–æ—Ö –¥—É–±–æ–≤–∏–π":          {"type": "quest", "desc": "–°—É—Ö–∏–π, –∞–ª–µ –º—ñ—Ü–Ω–∏–π."},
    "–°–∫–ª—è–Ω–∞ –±–∞–Ω—å–∫–∞":        {"type": "quest", "desc": "–©–æ–± –Ω–µ –±–∞—Ö–∫–∞–ª–æ ‚Äî –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø–æ—Å—É–¥."},
    "–ó—ñ–ª–ª—è —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—ó":   {"type": "consumable", "desc": "–¢—Ä–æ—Ö–∏ –≥–∞–ª—å–º—É—î –≤–∏–±—É—Ö–æ–≤—ñ —Å—é—Ä–ø—Ä–∏–∑–∏."},

    # –ù–∞—Å—Ç—è (–û–¥–µ—â–∏–Ω–∞)
    "–°–∫—Ä–∏–Ω—å–∫–∞ —Å–ø–µ—Ü—ñ–π":      {"type": "quest", "desc": "–°—É–º—ñ—à –≥–æ—Å—Ç—Ä–∞, —è–∫ —è–∑–∏–∫ –ù–∞—Å—Ç—ñ."},
    "–ü–µ—á–∞—Ç–∫–∞ –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫–∞":  {"type": "quest", "desc": "–ó–Ω–∞–∫, —â–æ –≤–∞–Ω—Ç–∞–∂ –ø—Ä–æ–π—à–æ–≤ –æ–≥–ª—è–¥."},
    "–¢–∞–ª–æ–Ω ¬´–°–æ–ª–æ–Ω–∏–π –ö–∏—à¬ª":  {"type": "trinket", "desc": "–ó–Ω–∏–∂–∫–∞ –≤—ñ–¥ –ù–∞—Å—Ç—ñ. –ü–æ-—Å–≤–æ–π—Å—å–∫–∏."},

    # –Æ—Ä–∫–æ (–ì–∞–ª–∏—á–∏–Ω–∞)
    "–Ü–∫–ª–æ —Å—Ç–µ–ø–æ–≤–æ–≥–æ –≥–Ω—É—Å–∞": {"type": "quest", "desc": "–ú–∞–ª–µ–Ω—å–∫–µ, —Ç–∞ –∫–∞–ø–æ—Å–Ω–µ."},
    "–ù–∞—à–∏–≤–∫–∞ –≤—ñ–¥–≤–∞–≥–∏":      {"type": "trinket", "desc": "–ù–æ—Å–∏—à ‚Äî —ñ –Ω–µ –ø–∞—Å—É—î—à."},
}
ITEM_NAMES: Set[str] = set(ITEM_CATALOG.keys())


def validate_items_exist(refs: Sequence[ItemRef]) -> None:
    """–ü–∞–¥–∞—î –∑ ValueError, —è–∫—â–æ –±—É–¥—å-—è–∫–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ –Ω–µ–º–∞—î –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ."""
    missing = [r.name for r in refs if r.name not in ITEM_NAMES]
    if missing:
        raise ValueError(f"Unknown quest items: {missing}")


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# ‚ù∂ –ë–µ—Ä–µ–≥–∏–Ω—è –û–∫—Å–∞–Ω–∞ (–ü–æ–ª—Ç–∞–≤—â–∏–Ω–∞)
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

def _quest_oksana() -> QuestDef:
    stages: Dict[str, QuestStage] = {
        "start": QuestStage(
            id="start",
            text_lines=(
                "–û–π, –¥—î—Ç–∫–æ, –∑–∞—Å–≤—ñ—Ç–∏ —Å–≤—ñ—á–∫—É –≤ —Å–µ—Ä—Ü—ñ ‚Äî —ñ –Ω—ñ—á –Ω–µ —Ç–∞–∫–∞ —Å—Ç—Ä–∞—à–Ω–∞.",
                "–®–æ —Å—Ç–æ—ó—à, —è–∫ –ø–µ–Ω—å–æ–∫? –ô–¥–∏-–Ω–æ –±–ª–∏–∂—á–µ ‚Äî –¥–æ–±—Ä–æ–º –ø–æ–¥—ñ–ª—é—Å—è.",
                "–°–≤—ñ—á—ñ —Ç–∞ –≤—ñ—Å–∫ —Å–∞–º—ñ –Ω–µ —Ä–æ—Å—Ç—É—Ç—å. –ü—Ä–∏–Ω–µ—Å–µ—à ‚Äî –æ—Å–≤—è—Ç–∏–º–æ —à–ª—è—Ö —Ç–≤—ñ–π.",
            ),
            choices={
                "‚úÖ ¬´–ü–æ–º–æ–∂—É, –ø–∞–Ω—ñ –ë–µ—Ä–µ–≥–∏–Ω–µ¬ª": "collect",
                "‚ùå ¬´–ù–µ –∑–∞—Ä–∞–∑¬ª": "reject",
            },
        ),
        "reject": QuestStage(
            id="reject",
            text_lines=("–ù–µ —Å–∏–ª—É–π —Å–µ–±–µ. –¢–∞ —Ç—ñ–ª—å–∫–∏ –∑–Ω–∞–π: —Ç–µ–º—Ä—è–≤–∞ –Ω–µ —á–µ–∫–∞—î.",),
            choices={},
            is_final=True,
        ),
        "collect": QuestStage(
            id="collect",
            text_lines=(
                "–î–æ–±—Ä–µ —Ä–æ–±–∏—à, –¥—î—Ç–∫–æ. –ü—Ä–∏–Ω–µ—Å–∏ –º–µ–Ω—ñ —Ç—Ä–æ—Ö–∏ –≤–æ—Å–∫—É ‚Äî —á–∏—Å—Ç–æ–≥–æ, —è–∫ —Ä–∞–Ω–∫–æ–≤–∞ —Ä–æ—Å–∞.",
                "–ú–µ–Ω—ñ —Ç—Ä–µ–±–∞: 3√ó ¬´–í—ñ—Å–∫-–æ–±–µ—Ä—ñ–≥¬ª. –¢–æ–¥—ñ —Å–≤—ñ—á–∫—É —Å–∫–ª–∞–¥–µ–º–æ ‚Äî —ñ —à–ª—è—Ö —è—Å–Ω—ñ—Ç–∏–º–µ.",
            ),
            choices={"üïØ ¬´–ü—Ä–∏–Ω—ñ—Å(–ª–∞) –≤—ñ—Å–∫¬ª": "turn_in"},
        ),
        "turn_in": QuestStage(
            id="turn_in",
            text_lines=(
                "–û—Ü–µ –¥–æ–±—Ä–µ, —Å–≤—ñ—Ç–ª–æ –ª—é–±–∏—Ç—å —Ö–æ—Ä–æ–±—Ä–∏—Ö.",
                "–ë–∞—á–∏—à? –°–≤—ñ—Ç–ª–æ —Å—Ç–∞–ª–æ —Ç–µ–ø–ª—ñ—à–∏–º ‚Äî –¥–æ—Ä–æ–≥–∞ –≤–∂–µ —è—Å–Ω—ñ—à–∞.",
            ),
            require_items=(ItemRef("–í—ñ—Å–∫-–æ–±–µ—Ä—ñ–≥", 3),),
            complete_reward=QuestReward(
                xp=35,
                chervontsi=50,
                items=(ItemRef("–°–≤—è—Ç–∞ —Å–≤—ñ—á–∫–∞ –û–∫—Å–∞–Ω–∏", 1),),
            ),
            is_final=True,
        ),
    }

    validate_items_exist(stages["turn_in"].require_items)
    validate_items_exist(stages["turn_in"].complete_reward.items)  # type: ignore

    return QuestDef(
        npc_key="berehynia_oksana",
        quest_key="oksana_light",
        title="–°–≤—ñ—á–∫–∞ –ë–µ—Ä–µ–≥–∏–Ω—ñ",
        description="–ü—Ä–∏–Ω–µ—Å—Ç–∏ –≤—ñ—Å–∫ –¥–ª—è —Å–≤—è—Ç–æ—ó —Å–≤—ñ—á–∫–∏, —â–æ –æ–±–µ—Ä—ñ–≥–∞—î –º–∞–Ω–¥—Ä—ñ–≤–Ω–∏–∫–∞.",
        stages=stages,
        start_id="start",
        once=True,
        level_req=1,
    )


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# ‚ù∑ –°–ª—ñ–ø–∏–π –ª—ñ—Ä–Ω–∏–∫ –°–µ–º–µ–Ω (–ü–æ–¥—ñ–ª–ª—è)
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

def _quest_semen() -> QuestDef:
    stages: Dict[str, QuestStage] = {
        "start": QuestStage(
            id="start",
            text_lines=(
                "“ê–µ–π, –≤—É–π–∫—É, –Ω–µ –ª—è–∫–∞–π—Å—è ‚Äî —Ç–æ —Å—Ç—Ä—É–Ω–∏ –º–æ—ó —Ç—Ä–µ–º—Ç—è—Ç—å, –Ω–µ –¥—É—à–∞ —Ç–≤–æ—è.",
                "–Ñ –∑–≤—ñ—Ä –ª—é—Ç–∏–π, —à–æ –≥–æ–ª–æ—Å –º—ñ–π –∫—Ä–∞–≤. –í–∏–≤–µ–¥–∏ –π–æ–≥–æ –Ω–∞ —á–∏—Å—Ç–µ ‚Äî –≤–µ—Ä–Ω—É –ø—ñ—Å–Ω—é –ª—é–¥—è–º.",
            ),
            choices={
                "‚úÖ ¬´–î–æ–±—Ä–µ, –ø–æ—à—É–∫–∞—é¬ª": "collect",
                "‚ùå ¬´–ù–µ –º–∞—é —á–∞—Å—É¬ª": "reject",
            },
        ),
        "reject": QuestStage(
            id="reject",
            text_lines=("–ï–≥–µ –∂, –¥–æ—Ä–æ–≥–∞ –≤—ñ–ª—å–Ω–∞. –¢—ñ–ª—å–∫–∏ –ø—ñ—Å–Ω—è –±–µ–∑ —Ç–µ–±–µ –±—É–¥–µ —Ç–∏—Ö—ñ—à–∞.",),
            is_final=True,
        ),
        "collect": QuestStage(
            id="collect",
            text_lines=(
                "–®—É–∫–∞–π —É —è—Ä–∞—Ö —Ç–µ–º–Ω–∏—Ö ‚Äî —Ç–∞–º –¥–µ –≤—ñ—Ç–µ—Ä —Å–≤–∏—â–µ, —è–∫ —Å—Ç—Ä—É–Ω–∞ –ø–æ—Ä–≤–∞–Ω–∞.",
                "–ü—Ä–∏–Ω–µ—Å–∏ 3√ó ¬´–ö—ñ–≥—Ç—ñ —è—Ä—É–∂–Ω–æ–≥–æ –≤–æ–≤–∫—É–ª–∞–∫–∏¬ª. –¢–æ–¥—ñ –π –∑–∞–≥—Ä–∞—é —Ç–æ–±—ñ —â–æ—Å—å —Ñ–∞–π–Ω–µ.",
            ),
            choices={"üéª ¬´–ú–∞—é —Ç—Ä–æ—Ñ–µ—ó¬ª": "turn_in"},
        ),
        "turn_in": QuestStage(
            id="turn_in",
            text_lines=("–û—Ü–µ –ø—ñ—Å–Ω—è! –ß—É—î—à, —è–∫ –ø–æ–ª–µ –≤—ñ–¥–≥—É–∫—É—î—Ç—å—Å—è? –°–ø–∞—Å–∏–±—ñ —Ç–æ–±—ñ, –≤—É–π–∫—É.",),
            require_items=(ItemRef("–ö—ñ–≥—Ç—ñ —è—Ä—É–∂–Ω–æ–≥–æ –≤–æ–≤–∫—É–ª–∞–∫–∏", 3),),
            complete_reward=QuestReward(
                xp=60,
                chervontsi=70,
                items=(ItemRef("–°—Ä—ñ–±–Ω–∏–π –º–µ–¥—è–∫ –°–µ–º–µ–Ω–∞", 1),),
            ),
            is_final=True,
        ),
    }

    validate_items_exist(stages["turn_in"].require_items)
    validate_items_exist(stages["turn_in"].complete_reward.items)  # type: ignore

    return QuestDef(
        npc_key="lirnyk_semen",
        quest_key="semen_song",
        title="–ü—ñ—Å–Ω—è –∑ —è—Ä—É–≥–∏",
        description="–î–æ–±—É—Ç–∏ –∫—ñ–≥—Ç—ñ —è—Ä—É–∂–Ω–æ–≥–æ –≤–æ–≤–∫—É–ª–∞–∫–∏, —â–æ–±–∏ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –ª—ñ—Ä–Ω–∏–∫—É –≥–æ–ª–æ—Å –ø—ñ—Å–Ω—ñ.",
        stages=stages,
        start_id="start",
        once=True,
        level_req=3,
    )


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# ‚ù∏ –ù–µ–¥–æ—á–∞–∫–ª—É–Ω –ü–∞–Ω–∞—Å (–ü–æ–ª—ñ—Å—Å—è)
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

def _quest_panas() -> QuestDef:
    stages: Dict[str, QuestStage] = {
        "start": QuestStage(
            id="start",
            text_lines=(
                "–ô–æ–π, —Ç–∞ —è –∂ —Ç—ñ–ª—å–∫–∏ —Ç—Ä–æ—Ö–∏ –∑–∞—á–∞–∫–ª—É–≤–∞–≤ ‚Äî –∞ –≤–æ–Ω–æ –±—É—Ö–Ω—É–ª–æ!",
                "–®–æ –∂ —Ç–∏, –ø–æ–º–æ–∂–∏ –∑—ñ–ª–ª—è –Ω–∞–∑–±–∏—Ä–∞—Ç–∏ ‚Äî –±–æ –±–µ–∑ –Ω—å–æ–≥–æ –∑–Ω–æ–≤ –±–∞—Ö–Ω–µ.",
            ),
            choices={
                "‚úÖ ¬´–ó–±–µ—Ä—É, –∞–±–∏ –Ω–µ –±–∞—Ö–∫–∞–ª–æ¬ª": "collect",
                "‚ùå ¬´–Ø –ø–∞—Å¬ª": "reject",
            },
        ),
        "reject": QuestStage(
            id="reject",
            text_lines=("–¢–∞ –π —Ç–∞–∫ –ø—ñ–¥–µ‚Ä¶ –ø–µ–≤–Ω–æ‚Ä¶ —è–∫–æ—Å—å‚Ä¶ –æ–π, –ª—ñ–ø—à–µ –Ω–µ —Ç—Ä–µ–±–∞.",),
            is_final=True,
        ),
        "collect": QuestStage(
            id="collect",
            text_lines=(
                "–¢—Ä–µ–±–∞: 5√ó ¬´–†—è—Å–∫–∞ –±–æ–ª–æ—Ç—è–Ω–∞¬ª, 2√ó ¬´–ú–æ—Ö –¥—É–±–æ–≤–∏–π¬ª, 1√ó ¬´–°–∫–ª—è–Ω–∞ –±–∞–Ω—å–∫–∞¬ª.",
                "–ê —è —Ç—É—Ç‚Ä¶ —Ç—Ä–æ—Ö–∏ –ø–æ—Å—Ç–æ—é –ø–æ–¥–∞–ª—ñ. –î–ª—è —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—ó, —Ç–∞–∫ —Å–∫–∞–∑–∞—Ç–∏.",
            ),
            choices={"üß™ ¬´–ü—Ä–∏–Ω—ñ—Å(–ª–∞) —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏¬ª": "turn_in"},
        ),
        "turn_in": QuestStage(
            id="turn_in",
            text_lines=("–û! –ù–µ –±–∞—Ö–∫–∞—î! –¢–∏ –º–∞–≥ –º–∞–π–∂–µ —è–∫ —è‚Ä¶ —Ç–æ–±—Ç–æ –∫—Ä–∞—â–µ.",),
            require_items=(
                ItemRef("–†—è—Å–∫–∞ –±–æ–ª–æ—Ç—è–Ω–∞", 5),
                ItemRef("–ú–æ—Ö –¥—É–±–æ–≤–∏–π", 2),
                ItemRef("–°–∫–ª—è–Ω–∞ –±–∞–Ω—å–∫–∞", 1),
            ),
            complete_reward=QuestReward(
                xp=45,
                chervontsi=40,
                items=(ItemRef("–ó—ñ–ª–ª—è —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—ó", 2),),
            ),
            is_final=True,
        ),
    }

    validate_items_exist(stages["turn_in"].require_items)
    validate_items_exist(stages["turn_in"].complete_reward.items)  # type: ignore

    return QuestDef(
        npc_key="nedochaklun_panas",
        quest_key="panas_stabilizer",
        title="–©–æ–± –Ω–µ –±–∞—Ö–∫–∞–ª–æ",
        description="–ó—ñ–±—Ä–∞—Ç–∏ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –¥–ª—è –ü–∞–Ω–∞—Å–∞, –∞–±–∏ –∑—ñ–ª–ª—è –ø–µ—Ä–µ—Å—Ç–∞–ª–æ –≤–∏–±—É—Ö–∞—Ç–∏.",
        stages=stages,
        start_id="start",
        once=True,
        level_req=1,
    )


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# ‚ùπ –ù–∞—Å—Ç—è ¬´–°–æ–ª–æ–Ω–∏–π –ö–∏—à¬ª (–û–¥–µ—â–∏–Ω–∞)
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

def _quest_nastia() -> QuestDef:
    stages: Dict[str, QuestStage] = {
        "start": QuestStage(
            id="start",
            text_lines=(
                "–°–æ–Ω–µ—á–∫–æ, –º–∞—é –¥—ñ–ª–æ–≤—É –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é ‚Äî –±–µ–∑ –ª–æ—Ö–∞ —ñ –∂–∏—Ç—Ç—è –Ω–µ —Ç–µ.",
                "–Ñ –∫–ª—ñ—î–Ω—Ç, –ª—é–±–∏—Ç—å –≥–æ—Å—Ç—Ä–µ. –ü—Ä–∏–Ω–µ—Å–µ—à —Å–ø–µ—Ü—ñ–π ‚Äî –∑—Ä–æ–±–ª—é —Ç–æ–±—ñ —Ü—ñ–Ω—É —è–∫ —Ä–æ–¥–∏—á—É.",
            ),
            choices={
                "‚úÖ ¬´–ô–¥—É –≤ –¥—ñ–ª—ñ¬ª": "collect",
                "‚ùå ¬´–ü–∞—Å¬ª": "reject",
            },
        ),
        "reject": QuestStage(
            id="reject",
            text_lines=("–ù–µ —à–æ—Ç–æ ‚Äî —Ç–≤–æ—è –≤–æ–ª—è. –¢—ñ–ª—å–∫–∏ –ø–æ—Ç—ñ–º –Ω–µ —à–∫–æ–¥—É–π.",),
            is_final=True,
        ),
        "collect": QuestStage(
            id="collect",
            text_lines=(
                "–ú–µ–Ω—ñ —Ç—Ä–µ–±–∞ 1√ó ¬´–°–∫—Ä–∏–Ω—å–∫–∞ —Å–ø–µ—Ü—ñ–π¬ª —ñ 1√ó ¬´–ü–µ—á–∞—Ç–∫–∞ –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫–∞¬ª.",
                "–ü–µ—á–∞—Ç–∫–∞ ‚Äî —Ç–æ —à–æ–± –Ω–µ —á—ñ–ø–∞–ª–∏ –ø–æ –¥–æ—Ä–æ–∑—ñ, —è—Å–Ω–æ? –ü—Ä–∞—Ü—é—î–º–æ –∫—É–ª—å—Ç—É—Ä–Ω–æ.",
            ),
            choices={"üßÇ ¬´–ú–∞—é —Å–ø–µ—Ü—ñ—ó –π –ø–µ—á–∞—Ç–∫—É¬ª": "turn_in"},
        ),
        "turn_in": QuestStage(
            id="turn_in",
            text_lines=("–ö—Ä–∞—Å–æ—Ç–∞! –¢–∏ —à–æ, –ø—Ä–æ—Ñ—ñ? –Ø –≤ –∑–∞—Ö–≤–∞—Ç—ñ, —á–µ—Å–Ω–µ —Å–ª–æ–≤–æ.",),
            require_items=(
                ItemRef("–°–∫—Ä–∏–Ω—å–∫–∞ —Å–ø–µ—Ü—ñ–π", 1),
                ItemRef("–ü–µ—á–∞—Ç–∫–∞ –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫–∞", 1),
            ),
            complete_reward=QuestReward(
                xp=55,
                chervontsi=120,
                items=(ItemRef("–¢–∞–ª–æ–Ω ¬´–°–æ–ª–æ–Ω–∏–π –ö–∏—à¬ª", 1),),
            ),
            is_final=True,
        ),
    }

    validate_items_exist(stages["turn_in"].require_items)
    validate_items_exist(stages["turn_in"].complete_reward.items)  # type: ignore

    return QuestDef(
        npc_key="nastia_salt_belly",
        quest_key="nastia_spice_run",
        title="–ì–æ—Å—Ç—Ä–∏–π –Ω–∞ —è–∑–∏–∫ –≤–∞–Ω—Ç–∞–∂",
        description="–î—ñ—Å—Ç–∞—Ç–∏ —Å–∫—Ä–∏–Ω—å–∫—É —Å–ø–µ—Ü—ñ–π —ñ –ø–µ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫–∞ –¥–ª—è –ù–∞—Å—Ç—ñ.",
        stages=stages,
        start_id="start",
        once=True,
        level_req=5,
    )


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# ‚ù∫ –Æ—Ä–∫–æ-–†–µ–∫—Ä—É—Ç (–ì–∞–ª–∏—á–∏–Ω–∞)
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

def _quest_yurko() -> QuestDef:
    stages: Dict[str, QuestStage] = {
        "start": QuestStage(
            id="start",
            text_lines=(
                "–¢–∞ –π–æ–π! –¢–∏ —è–∫—Ä–∞–∑ –º–µ–Ω—ñ —Ç—Ä–µ–±–∞! –®–æ, –ø—ñ–¥–µ–º–æ –≤ –±—ñ–π–∫—É —á–∏ —è–∫?",
                "–ó–±–µ—Ä–∏ –ø–∞—Ä—É —Ç—Ä–æ—Ñ–µ—ó–≤ ‚Äî –ø–æ–∫–∞–∂–µ–º–æ, —à–æ –º–∏ –∑ –Ω–∞—à–æ—ó –∑–∞—Å—Ç–∞–≤–∏ –Ω–µ –ª—è–∫–∞—î–º–æ—Å—å!",
            ),
            choices={
                "‚úÖ ¬´–ë–µ—Ä—É —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è¬ª": "collect",
                "‚ùå ¬´–ú–∞—é —ñ–Ω—à—ñ —Å–ø—Ä–∞–≤–∏¬ª": "reject",
            },
        ),
        "reject": QuestStage(
            id="reject",
            text_lines=("–ï–π, –Ω–µ –∫—Ä—É—Ç –Ω–æ—Å–æ–º. –Ø–∫ –Ω–∞–¥—É–º–∞—î—à ‚Äî –≥—É–∫–∞–π.",),
            is_final=True,
        ),
        "collect": QuestStage(
            id="collect",
            text_lines=("–ú–µ–Ω—ñ —Ç—Ä–µ–±–∞ 5√ó ¬´–Ü–∫–ª–æ —Å—Ç–µ–ø–æ–≤–æ–≥–æ –≥–Ω—É—Å–∞¬ª. –ù–∞–±‚Äô—î–º–æ —Ä—É–∫—É ‚Äî —ñ –¥—É—Ö –ø—ñ–¥–µ!",),
            choices={"ü¶¥ ¬´–ü—Ä–∏–Ω—ñ—Å(–ª–∞) —ñ–∫–ª–∞¬ª": "turn_in"},
        ),
        "turn_in": QuestStage(
            id="turn_in",
            text_lines=("–û—Ü–µ —Ä–æ–±–æ—Ç–∞! –í–∏–¥–∏—à? –î—É—Ö —î! –î–∞–ª—ñ –±—É–¥–µ —â–µ –ª—ñ–ø—à–µ.",),
            require_items=(ItemRef("–Ü–∫–ª–æ —Å—Ç–µ–ø–æ–≤–æ–≥–æ –≥–Ω—É—Å–∞", 5),),
            complete_reward=QuestReward(
                xp=70,
                chervontsi=80,
                items=(ItemRef("–ù–∞—à–∏–≤–∫–∞ –≤—ñ–¥–≤–∞–≥–∏", 1),),
            ),
            is_final=True,
        ),
    }

    validate_items_exist(stages["turn_in"].require_items)
    validate_items_exist(stages["turn_in"].complete_reward.items)  # type: ignore

    return QuestDef(
        npc_key="yurko_rekrut",
        quest_key="yurko_trophies",
        title="–ù–∞–±–∏—Ç–∏ —Ä—É–∫—É",
        description="–ó—ñ–±—Ä–∞—Ç–∏ —ñ–∫–ª–∞ —Å—Ç–µ–ø–æ–≤–æ–≥–æ –≥–Ω—É—Å–∞, –∞–±–∏ –ø–æ–∫–∞–∑–∞—Ç–∏ –≤—ñ–¥–≤–∞–≥—É –Ω–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—ñ.",
        stages=stages,
        start_id="start",
        once=True,
        level_req=2,
    )


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# –†–ï–Ñ–°–¢–† –ö–í–ï–°–¢–Ü–í
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

ALL_QUESTS: List[QuestDef] = [
    _quest_oksana(),
    _quest_semen(),
    _quest_panas(),
    _quest_nastia(),
    _quest_yurko(),
]

QUESTS_BY_KEY: Dict[str, QuestDef] = {q.quest_key: q for q in ALL_QUESTS}

QUESTS_BY_NPC: Dict[str, List[QuestDef]] = {}
for q in ALL_QUESTS:
    QUESTS_BY_NPC.setdefault(q.npc_key, []).append(q)


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# –ü–£–ë–õ–Ü–ß–ù–Ü –•–ï–õ–ü–ï–†–ò –î–õ–Ø –Ü–ù–¢–ï–ì–†–ê–¶–Ü–á (API/—Ä–æ—É—Ç–µ—Ä–∏)
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

def get_quests_for_npc(npc_key: str) -> Sequence[QuestDef]:
    """–ö–≤–µ—Å—Ç–∏, —è–∫—ñ –ø—Ä–æ–ø–æ–Ω—É—î NPC."""
    return tuple(QUESTS_BY_NPC.get(npc_key, []))

def get_quest(quest_key: str) -> Optional[QuestDef]:
    """–ö–≤–µ—Å—Ç –∑–∞ –∫–ª—é—á–µ–º –∞–±–æ None."""
    return QUESTS_BY_KEY.get(quest_key)

def all_quest_items() -> Sequence[str]:
    """–í—Å—ñ –Ω–∞–∑–≤–∏ –ø—Ä–µ–¥–º–µ—Ç—ñ–≤, —â–æ —Ñ—ñ–≥—É—Ä—É—é—Ç—å —É —Ü–∏—Ö –∫–≤–µ—Å—Ç–∞—Ö."""
    names: Set[str] = set()
    for q in ALL_QUESTS:
        for s in q.stages.values():
            for r in s.require_items:
                names.add(r.name)
            if s.complete_reward:
                for g in s.complete_reward.items:
                    names.add(g.name)
    return tuple(sorted(names))

def get_item_meta(name: str) -> Optional[Dict[str, str | int]]:
    """–ú–µ—Ç–∞–¥–∞–Ω—ñ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É (type, desc)."""
    return ITEM_CATALOG.get(name)

def quests_json_for_npc(npc_key: str) -> List[Dict[str, Any]]:
    """–ì–æ—Ç–æ–≤–∏–π –¥–ª—è FastAPI JSON: —Å–ø–∏—Å–æ–∫ –∫–≤–µ—Å—Ç—ñ–≤ NPC —É dict-—Ñ–æ—Ä–º–∞—Ç—ñ."""
    return [q.to_dict() for q in get_quests_for_npc(npc_key)]

def quest_json(quest_key: str) -> Optional[Dict[str, Any]]:
    """–ì–æ—Ç–æ–≤–∏–π –¥–ª—è FastAPI JSON –æ–¥–Ω–æ–≥–æ –∫–≤–µ—Å—Ç—É."""
    q = get_quest(quest_key)
    return q.to_dict() if q else None


__all__ = [
    "ItemRef",
    "QuestReward",
    "QuestStage",
    "QuestDef",
    "ITEM_CATALOG",
    "ITEM_NAMES",
    "validate_items_exist",
    "ALL_QUESTS",
    "QUESTS_BY_KEY",
    "QUESTS_BY_NPC",
    "get_quests_for_npc",
    "get_quest",
    "all_quest_items",
    "get_item_meta",
    "quests_json_for_npc",
    "quest_json",
]